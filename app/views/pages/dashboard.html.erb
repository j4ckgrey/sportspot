<div class="container my-5 bg-light shadow">
  <% if current_user.is_user? %>
    <ul class="nav nav-tabs rounded border" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">Pending</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#confirmed" type="button" role="tab" aria-controls="confirmed" aria-selected="false">Confirmed</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#declined" type="button" role="tab" aria-controls="declined" aria-selected="false">Declined</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Profile</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="home-tab">
        <% @mybookings.each do |booking| %>
          <% if booking.pending? %>
          <div class="card mb-2 bg-light shadow rounded-3">
            <div class="card-body d-flex justify-content-between align-items-center p-3">
              <div>
                <h3><strong><%= booking.venue.name %></strong></h3>
                <h5><small><%= booking.venue.club.name %> - <%= booking.venue.club.address %></small></h5>
                <h6><small>Date: <%= booking.date %> Time: <%= booking.time.strftime("at %l:%M %p") %></small></h6>
              </div>
              <div>
                <p class="w-100 bg-info bg-gradient text-dark text-center borders rounded"><strong><%= booking.status.capitalize %></strong></p>
                <%= link_to "Cancel my Booking", booking_path(booking), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to cancel?' }, class:"d-block btn btn-secondary btn-sm" %>
                <%= link_to "Visit venue", venue_path(booking.venue), class:"d-block btn btn-secondary btn-sm mt-2" %>
              </div>
            </div>
          </div>
          <% end %>
        <% end %>
      </div>
      <div class="tab-pane fade" id="confirmed" role="tabpanel" aria-labelledby="profile-tab">
        <% @mybookings.each do |booking| %>
          <% if booking.confirmed? %>
            <div class="card mb-2 bg-light">
              <div class="card-body d-flex justify-content-between align-items-center p-3">
                <div>
                  <h3><strong><%= booking.venue.name %></strong></h3>
                  <h5><small><%= booking.venue.club.name %> - <%= booking.venue.club.address %></small></h5>
                  <h6><small>Date: <%= booking.date %> Time: <%= booking.time.strftime("at %l:%M %p") %></small></h6>
                </div>
                <div>
                  <p class="w-100 bg-success bg-gradient text-dark text-center borders rounded"><strong><%= booking.status.capitalize %></strong></p>
                  <%= link_to "Cancel my Booking", booking_path(booking), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to cancel?' }, class:"d-block btn btn-secondary btn-sm" %>
                  <%= link_to "Visit venue", venue_path(booking.venue), class:"d-block btn btn-secondary btn-sm mt-2" %>
                    <button type="button" class="w-100 mt-2 btn d-flex justify-content-center", style="color:white;background-color:#9cbfdd;" data-bs-toggle="modal" data-bs-target="#exampleModal">Submit review</button>
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Review</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <%= simple_form_for(@review) do |f| %>
                            <div class="modal-body">
                              <%= f.hidden_field :booking_id, { value: booking.id } %>
                              <%= f.input :title %>
                              <%= f.input :comment %>
                              <%= f.input :rating, collection: 1..5 %>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                              <%= f.submit 'Submit', class: "btn btn-primary" %>
                            </div>
                          <% end %>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="tab-pane fade" id="declined" role="tabpanel" aria-labelledby="contact-tab">
        <% @mybookings.each do |booking| %>
          <% if booking.declined? %>
          <div class="card mb-2 bg-light rounded-3">
            <div class="card-body d-flex justify-content-between align-items-center p-3">
              <div>
                <h3><strong><%= booking.venue.name %></strong></h3>
                <h5><small><%= booking.venue.club.name %> - <%= booking.venue.club.address %></small></h5>
                <h6><small>Date: <%= booking.date %> Time: <%= booking.time.strftime("at %l:%M %p") %></small></h6>
              </div>
              <div>
                <p class="w-100 bg-danger bg-gradient text-dark text-center borders rounded"><strong><%= booking.status.capitalize %></strong></p>
                <%= link_to "Cancel my Booking", booking_path(booking), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to cancel?' }, class:"d-block btn btn-secondary btn-sm" %>
                <%= link_to "Visit venue", venue_path(booking.venue), class:"d-block btn btn-secondary btn-sm mt-2" %>
              </div>
            </div>
          </div>
          <% end %>
        <% end %>
      </div>
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="home-tab">
        <%= render "shared/user", user: @user %>
      </div>
    </div>
  <% end %>

  <% if current_user.is_owner? %>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#clubs" type="button" role="tab" aria-controls="clubs" aria-selected="true">Clubs</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button" role="tab" aria-controls="requests" aria-selected="false">Pending</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#confirmed" type="button" role="tab" aria-controls="confirmed" aria-selected="false">Confirmed</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Profile</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="clubs" role="tabpanel" aria-labelledby="home-tab">
        <div class="row justify-content-center">
        <h3 class="bg-secondary bg-gradient text-white text-center">Owned clubs</h3>
        <div class="row shadow bg-light d-flex justify-content-center">
          <% @owns.each do |club| %>
            <div class="card club-card shadow p-3 mb-4 bg-light rounded-3 text-center m-3" style="width: 15rem; height:15rem;">
              <img src="https://www.gardasee.de/sites/default/files/teaserimg/tennis_adobestock_285441870_0.jpeg" class="card-img-top shadow border-1 rounded-3 mt-1" alt="Club Image">
              <div class="card-body d-flex flex-column justify-content-between">
                <div>
                  <p class="card-title"><%= club.name %></p>
                </div>
                <%= link_to "", club, class:"stretched-link" %>
              </div>
            </div>
          <% end %>
        </div>
        </div>
      </div>
      <div class="tab-pane fade" id="requests" role="tabpanel" aria-labelledby="profile-tab">
        <h3 class="bg-secondary bg-gradient text-white text-center">Pending requests</h3>
        <div class="card mb-3 p-3 bg-light shadow rounded-3">
            <%# <%if current_user.venues.bookings.present?%> 
            <% current_user.venues.each do |venue| %>
                          <% venue.bookings.each do |booking| %>
                            <% if booking.pending? %>
                              <div>
                                <h3><strong><%= booking.user.first_name %></strong> requested booking for <strong><%= booking.venue.name %></strong> in <%= booking.venue.club.name %></h3>
                                <h6>On: <%= booking.date %> <%= booking.time.strftime("at %l:%M %p") %></h6>
                              </div>
                              <div>
                                <%= link_to "Confirm", booking_path(booking, booking: {status: :confirmed}), data: { turbo_method: :patch, turbo_confirm: 'Are you sure you want to confirm?' }, class:"btn btn-primary btn-sm" %>
                                <%= link_to "Decline", booking_path(booking, booking: {status: :declined}), data: { turbo_method: :patch, turbo_confirm: 'Are you sure you want to decline?' }, class:"btn btn-secondary btn-sm" %>
                              </div>
                              <% end %>
                          <% end %>
              <%# <%else%>
                <%# <h5>Sorry, you do not have any pending requests.</h5> %>
              <%# <% end %>
            <% end %>
        </div>
      </div>
      <div class="tab-pane fade" id="confirmed" role="tabpanel" aria-labelledby="contact-tab">
        <h3 class="bg-secondary bg-gradient text-white text-center">Confirmed requests</h3>
          <div class="card mb-3 p-3 bg-light shadow rounded-3">
            <% current_user.venues.each do |venue| %>
              <% venue.bookings.each do |booking| %>
                <%if booking.confirmed? %>
                      <div>
                        <h6><strong><%= booking.user.first_name %></strong>'s booking for <strong><%= venue.name %></strong> on <%= booking.date %> at <%= booking.time.strftime("at %l:%M %p") %> has been <mark style="background: #FFFFFF!important" class="text-success">confirmed</mark>.</h6>
                      </div>
                <%else%>
                      <h6><strong><%= booking.user.first_name %></strong>'s booking for <strong><%= venue.name %></strong> on <%= booking.date %> at <%= booking.time.strftime("at %l:%M %p") %> has been <mark style="background: #FFFFFF!important" class="text-danger">declined</mark>.</h6>
                <%end%>
               <hr>
              <% end %>
            <% end %>
        </div>
      </div>
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="home-tab">
        <%= render "shared/user", user: @user %>
      </div>
    </div>
  <% end %>

    <% if current_user.is_admin? %>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#clubs" type="button" role="tab" aria-controls="clubs" aria-selected="true">Clubs</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Profile</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="clubs" role="tabpanel" aria-labelledby="home-tab">
        <div class="row justify-content-center">
        <h3 class="bg-secondary bg-gradient text-white text-center">All clubs</h3>
        <div class="row shadow bg-light d-flex justify-content-center">
          <% @clubs.each do |club| %>
            <div class="card club-card shadow p-3 mb-4 bg-light rounded-3 text-center m-3" style="width: 15rem; height:15rem;">
              <img src="https://www.gardasee.de/sites/default/files/teaserimg/tennis_adobestock_285441870_0.jpeg" class="card-img-top shadow border-1 rounded-3 mt-1" alt="Club Image">
              <div class="card-body d-flex flex-column justify-content-between">
                <div>
                  <p class="card-title"><%= club.name %></p>
                </div>
                <%= link_to "", club, class:"stretched-link" %>
              </div>
            </div>
          <% end %>
        </div>
        </div>
      </div>
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="home-tab">
        <%= render "shared/user", user: @user %>
      </div>
    </div>
  <% end %>
</div>
